<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Meu Carrinho</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header class="top-header">
      <div class="logo">
        <a href="{{ url_for('index') }}">
          <a href="{{ url_for('index') }}"><img src="../static/media/login/logo.png" alt="Logo"></a>
        </a>
      </div>
  
      <div class="search-bar">
        <input type="text" placeholder="Buscar..." />
        <span class="search-icon">&#128269;</span> 
      </div>
  
      <div class="icons"> 
        <a href="{{ url_for('login') }}">
          <img src="../static/media/login/usuario.png" alt="">
        </a>
      </div>
  </header>

  <div class="main-content-carrinho">
    <div class="cart-container">

      <!-- Seção de itens -->
      <div class="cart-section">
        <div class="cart-card">
          <div class="cart-title">Meu carrinho</div>
          <div class="product-list">
            {% if itens %}
                {% for item in itens %}
                <div class="product-item">
                  <!-- Imagem da máquina -->
                  <img class="product-image" 
                       src="{{ item['imagem'] }}" 
                       alt="{{ item['modelo_maquina'] }}" />

                  <div class="product-info">
                    <div class="product-name">{{ item['modelo_maquina'] }}</div>
                  </div>

                  <!-- Controle de quantidade -->
                  <div class="quantity-control">
                    <div class="quantity-buttons">
                      <form method="POST" action="{{ url_for('carrinho_adicionar') }}">
                          <input type="hidden" name="maquina_id" value="{{ item['id'] }}">
                          <button type="submit" name="acao" value="decrement">-</button>
                          <span class="quantity-value">{{ item['quantidade'] }}</span>
                          <button type="submit" name="acao" value="increment">+</button>
                      </form>
                    </div>
                    <span class="quantity-label">{{ item['forma_aluguel']|capitalize }}</span>
                  </div>

                  <!-- Preço e subtotal -->
                  <div class="product-price">
                    {{ item['quantidade'] }}x R$ {{ '%.2f'|format(item['preco']) }}<br/>
                    Total: <span class="price-total">R$ {{ '%.2f'|format(item['preco']*item['quantidade']) }}</span>
                  </div>

                  <!-- Remover item -->
                  <div class="remove-item">
                    <form method="POST" action="{{ url_for('remover_do_carrinho') }}">
                      <input type="hidden" name="maquina_id" value="{{ item['item_id'] }}"> 
                      <button class="remove-item-btn" data-item-id="{{ item['item_id'] }}">Remover</button>
                    </form>
                  </div>
                </div>
                {% endfor %}
            {% else %}
                <p>Seu carrinho está vazio.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Resumo do pedido -->
      <div class="summary-section">
        <div class="summary-title">Resumo</div>
        <div class="summary-row">
          <span>Subtotal</span>
          <span>R$ {{ '%.2f'|format(subtotal) }}</span>
        </div>
        {% if desconto > 0 %}
        <div class="summary-row discount">
          <span>Desconto ({{ cupom_aplicado.codigo }})</span>
          <span>- R$ {{ '%.2f'|format(desconto) }}</span>
        </div>
        {% endif %}
        <div class="summary-row bold">
          <span>Total</span>
          <span>R$ {{ '%.2f'|format(total) }}</span>
        </div>
        {% if not cupom_aplicado %}
        <input class="coupon-input" placeholder="Cupom de desconto" />
        {% else %}
        <div class="applied-coupon">
          <span>Cupom aplicado: {{ cupom_aplicado.codigo }}</span>
          <button onclick="removerCupom()" class="remove-coupon">Remover</button>
        </div>
        {% endif %}
        <button class="finish-button" data-url="{{ url_for('finaliza_pedido') }}">Finalizar Pedido</button>
      </div>

    </div>
  </div>

  <script src="{{ url_for('static', filename='js/carrinho.js') }}"></script>
  <script src="{{ url_for('static', filename='js/carrinho-ajax.js') }}"></script>
  {% block footer %}
    {% include 'pages/footer.html' %}
  {% endblock %}
</body>
</html>
