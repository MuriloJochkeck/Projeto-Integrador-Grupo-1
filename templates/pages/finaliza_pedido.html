<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finalizar Pedido</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <header class="top-header">
      <div class="logo">
        <a href="{{ url_for('index') }}"
          ><img src="{{ url_for('static', filename='media/login/logo.png') }}" alt="Logo"
        /></a>
      </div>

      <div class="icons">
        <a href="{{ url_for('carrinho') }}">
          <img
            src="{{ url_for('static', filename='media/login/carrinho.png') }}"
            alt="Carrinho"
          />
        </a>
        <a href="{{ url_for('login') }}">
          <img
            class="user-icon"
            src="{{ url_for('static', filename='media/login/7407992-pessoa-icone-cliente-simbolo-vetor-removebg-preview.png') }}"
            alt="Entrar"
          />
        </a>
      </div>
    </header>
    <main>
      <div class="checkout-container">
        <h1 class="checkout-title">Finalizar Pedido</h1>
        <div class="main-sections">
          <div class="products-section">
            <table class="products-table">
              <thead>
                <tr>
                  <th>Produtos</th>
                  <th>Quantidade</th>
                  <th>Valor</th>
                </tr>
              </thead>
              <tbody>
                {% for item in carrinho %}
                <tr>
                  <td>
                    <div class="product-info">
                      <img src="{{ url_for('static', filename=item['imagem']) }}" alt="{{ item['modelo_maquina'] }}" class="product-thumb">
                      <span>{{ item['modelo_maquina'] }}</span>
                    </div>
                  </td>
                  <td>{{ item['quantidade'] }} {{ item['forma_aluguel'] }}</td>
                  <td>R$ {{ '%.2f'|format(item['preco'] * item['quantidade']) }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="summary-section">
            <h2>Resumo</h2>
            <div class="summary-row">Subtotal <span>R$ {{ '%.2f'|format(subtotal) }}</span></div>
            {% if desconto > 0 %}
            <div class="summary-row discount">Desconto <span>- R$ {{ '%.2f'|format(desconto) }}</span></div>
            {% endif %}
            <div class="summary-row total">Total <span>R$ {{ '%.2f'|format(total) }}</span></div>
            {% if not cupom_aplicado %}
            <button class="coupon-btn">Cupom de desconto</button>
            {% else %}
            <div class="applied-coupon">
              <span>Cupom aplicado: {{ cupom_aplicado.codigo }}</span>
              <button onclick="removerCupom()" class="remove-coupon">Remover</button>
            </div>
            {% endif %}
          </div>
        </div>
        <div class="payment-section">
          <h3>Métodos de pagamento</h3>
          <div class="payment-methods">
            <div class="pix-method">
              <label><input type="radio" name="payment" checked /> PIX</label>
              <img
                src="{{ url_for('static', filename='media/download.png') }}"
                alt="QR Code"
                class="qrcode-img"
              />
              <button class="copy-btn">Clique para copiar</button>
            </div>
            <div class="card-method">
              <label><input type="radio" name="payment" /> Cartão</label>
              <div class="card-options">
                <div>NU PAGAMENTOS SA *1234</div>
                <table class="installments-table" id="installments-table">
                  <!-- Parcelas serão geradas dinamicamente via JavaScript -->
                </table>
              </div>
              <div class="add-card">
                <p class="add-card-btn">+ Adicionar cartão</p>
                <div class="card-form">
                  <input type="text" placeholder="Nome no Cartão" />
                  <input type="text" placeholder="Número do Cartão" />
                  <input type="text" placeholder="Data de Validade (MM/AA)" />
                  <input type="text" placeholder="CVV" />
                  <button class="send-card-btn">Enviar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="actions">
          <button class="back-btn">Voltar</button>
          <button class="finish-btn">Finalizar Pedido</button>
        </div>
      </div>
    </main>
    {% block footer %}
    {% include 'pages/footer.html' %}
    {% endblock %}
    
    <script src="{{ url_for('static', filename='js/finaliza_pedido.js') }}"></script>
  </body>
</html>
